
<!DOCTYPE html>
<html>
<head>
    <title>Questionary</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .question { margin-bottom: 25px; border-bottom:1px solid #ddd; padding-bottom:15px; }
        .correct { color: green; font-weight:bold; }
        .wrong { color: red; font-weight:bold; }
        .submit-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 20px;
            background: blue;
            color: white;
            border: none;
            cursor: pointer;
        }
        input[type=text] { width:100%; padding:8px; margin-bottom:20px; }
    </style>
</head>
<body>

<h1>Practice Quiz</h1>

<input type="text" id="searchBox" placeholder="Search question description..." oninput="searchQuestions()">

<div id="questions">

    {% for question in questions %}

        {% if question.structure == 1 %}

            <div class="question"
                id="question-{{ question.QuestionId }}"
                data-description="{{ question.QuestionImageText | join(' ') | lower }}">


                <h3>Question {{ loop.index }}</h3>

                {% for text in question.QuestionImageText %}
                    <p>{{ text }}</p>
                {% endfor %}

                {% for img in question.QuestionImages %}
                    {% if img %}
                        <img src="data:image/png;base64,{{ img }}" width="50%">
                    {% endif %}
                {% endfor %}

                <div>
                    {% for opt in question.examDemoOptionDto %}
                        <label>
                            <input type="radio"
                                name="q{{ question.QuestionId }}"
                                data-correct="{{ opt.CHOICEOPTION }}"
                                onclick="checkAnswer(this)">
                            {{ opt.CHOICETEXT }}

                            {% if opt.CHOICEIMAGE %}
                                <img src="data:image/png;base64,{{ opt.CHOICEIMAGE }}">
                            {% endif %}
                        </label>
                        <br>
                    {% endfor %}
                </div>

                <p class="result"></p>
            </div>

        {% else %}

            <div class="question" data-description="{{ question.description | lower }}">
                
                <h3>Question {{ loop.index }}</h3>

                <p>Module: {{ question.module }}</p>
                
                <p>{{ question.description }}</p>

                {% for img in question.images %}
                    {% if img %}
                        <img src="{% if img.startswith('data:image') %}{{ img }}{% else %}data:image/png;base64,{{ img }}{% endif %}" width="50%"/>
                    {% endif %}
                {% endfor %}

                <div>
                    {% for choice in question.choices %}
                        <label>
                            <input type="radio"
                                name="q{{ question.id }}"
                                data-correct="{{ choice.answer }}"
                                onclick="checkAnswer(this)">
                            {{ choice.text }}
                        </label><br>
                    {% endfor %}
                </div>

                <p class="result"></p>
            </div>


        {% endif %}

    {% endfor %}

</div>

<button class="submit-btn" onclick="submitPractice()">Submit</button>

<script>
    let score = 0;
    let total = {{ questions|length }};

    function searchQuestions() {
        const value = document.getElementById("searchBox").value.toLowerCase();

        document.querySelectorAll(".question").forEach(question => {
            question.style.display = question.dataset.description.includes(value) ? "block" : "none";
        });
    }

function checkAnswer(radio) {
    const result = radio.closest(".question").querySelector(".result");

    if (radio.dataset.correct === "True") {
        result.innerHTML = "✔ Correct";
        result.className = "result correct";
    } else {
        result.innerHTML = "✖ Wrong";
        result.className = "result wrong";
    }
}

function submitPractice() {
    let correct = 0;
    let wrong = 0;

    document.querySelectorAll(".question").forEach(question => {
        const selected = question.querySelector("input[type=radio]:checked");

        if (selected) {
            if (selected.dataset.correct === "True") {
                correct++;
            } else {
                wrong++;
            }
        }
    });

    let finalScore = correct - (wrong * 0.5);
    let percentage = ((finalScore / total) * 100).toFixed(2);
    let passed = percentage >= 70;

    alert(
        `Score: ${finalScore}\nPercentage: ${percentage}%\nResult: ${passed ? "PASSED" : "FAILED"}`
    );
}
</script>

</body>
</html>
